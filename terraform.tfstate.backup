{
  "version": 4,
  "terraform_version": "0.12.3",
  "serial": 215,
  "lineage": "13a3776c-8212-a9f2-4409-39a3deb0f97a",
  "outputs": {
    "Cowrie_Admin_SSH": {
      "value": "ssh -i HP-default.pem -p 22222 ubuntu@52.50.95.239",
      "type": "string"
    },
    "Cowrie_HoneyPot_SSH": {
      "value": "ssh testuser@52.50.95.239",
      "type": "string"
    },
    "Cowrie_IP": {
      "value": [
        "52.50.95.239"
      ],
      "type": [
        "tuple",
        [
          "string"
        ]
      ]
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "template_file",
      "name": "cowrie_user_data",
      "provider": "provider.template",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "78414c7fe6f11c219ee883153fd861471598e602f4c7007220b235a145690be2",
            "rendered": "#!/bin/bash\n\necho \"Moving SSHD Port\" \u003e\u003e /home/build.log\ncat /etc/ssh/sshd_config | sed s/\"#Port 22\"/\"Port 22222\"/ \u003e /tmp/sshd_out\nmv /tmp/sshd_out /etc/ssh/sshd_config\nservice ssh restart\n\n# based on https://cowrie.readthedocs.io/en/latest/INSTALL.html\necho \"updating\" \u003e\u003e /home/build.log\n\napt -y update \nDEBIAN_FRONTEND=noninteractive apt -y upgrade #dying on graphical question, #TOFIX\napt -y install git python-virtualenv libssl-dev libffi-dev build-essential libpython3-dev python3-minimal authbind virtualenv\n\necho \"Adding user\" \u003e\u003e /home/build.log\nadduser --disabled-password --gecos \"\" cowrie\n\necho \"HereDoc blob\" \u003e\u003e /home/build.log \nsudo -H -u cowrie /bin/bash -s \u003c\u003c EOF \u003e\u003e /home/cowrie/heredoc.out\ncd /home/cowrie/\ngit clone http://github.com/cowrie/cowrie\ncd /home/cowrie/cowrie\nvirtualenv --python=python3 cowrie-env\nsource cowrie-env/bin/activate\npip install --upgrade pip\npip install --upgrade -r requirements.txt\nbin/cowrie start\nEOF\n# runs with cowrie.cfg.dist - will need tuning to specific usecase\n\necho \"Mapping to TCP:22\" \u003e\u003e /home/build.log\niptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222\necho \"DONE\" \u003e\u003e /home/build.log",
            "template": "#!/bin/bash\n\necho \"Moving SSHD Port\" \u003e\u003e /home/build.log\ncat /etc/ssh/sshd_config | sed s/\"#Port 22\"/\"Port 22222\"/ \u003e /tmp/sshd_out\nmv /tmp/sshd_out /etc/ssh/sshd_config\nservice ssh restart\n\n# based on https://cowrie.readthedocs.io/en/latest/INSTALL.html\necho \"updating\" \u003e\u003e /home/build.log\n\napt -y update \nDEBIAN_FRONTEND=noninteractive apt -y upgrade #dying on graphical question, #TOFIX\napt -y install git python-virtualenv libssl-dev libffi-dev build-essential libpython3-dev python3-minimal authbind virtualenv\n\necho \"Adding user\" \u003e\u003e /home/build.log\nadduser --disabled-password --gecos \"\" cowrie\n\necho \"HereDoc blob\" \u003e\u003e /home/build.log \nsudo -H -u cowrie /bin/bash -s \u003c\u003c EOF \u003e\u003e /home/cowrie/heredoc.out\ncd /home/cowrie/\ngit clone http://github.com/cowrie/cowrie\ncd /home/cowrie/cowrie\nvirtualenv --python=python3 cowrie-env\nsource cowrie-env/bin/activate\npip install --upgrade pip\npip install --upgrade -r requirements.txt\nbin/cowrie start\nEOF\n# runs with cowrie.cfg.dist - will need tuning to specific usecase\n\necho \"Mapping to TCP:22\" \u003e\u003e /home/build.log\niptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222\necho \"DONE\" \u003e\u003e /home/build.log",
            "vars": null
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "CowrieTFWIP",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "ami": "ami-02df9ea15c1778c9c",
            "arn": "arn:aws:ec2:eu-west-1:228434638586:instance/i-0b17bd12feb7ae1f6",
            "associate_public_ip_address": true,
            "availability_zone": "eu-west-1b",
            "cpu_core_count": 1,
            "cpu_threads_per_core": 2,
            "credit_specification": [
              {
                "cpu_credits": "unlimited"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "ephemeral_block_device": [],
            "get_password_data": false,
            "host_id": null,
            "iam_instance_profile": "",
            "id": "i-0b17bd12feb7ae1f6",
            "instance_initiated_shutdown_behavior": null,
            "instance_state": "running",
            "instance_type": "t3.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "HP-default",
            "monitoring": false,
            "network_interface": [],
            "network_interface_id": null,
            "password_data": "",
            "placement_group": "",
            "primary_network_interface_id": "eni-01b50cd5fafdab226",
            "private_dns": "ip-172-31-31-213.eu-west-1.compute.internal",
            "private_ip": "172.31.31.213",
            "public_dns": "ec2-52-50-95-239.eu-west-1.compute.amazonaws.com",
            "public_ip": "52.50.95.239",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "volume_id": "vol-03a54626f2f6ded22",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "security_groups": [
              "Allow BECL46 Admin",
              "Cowrie Honeypot Ports"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-37a7ff7f",
            "tags": {
              "Name": "CowrieViaTF"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "734eac6313b2ef3f162e816b02292348ac1195e0",
            "user_data_base64": null,
            "volume_tags": {},
            "vpc_security_group_ids": [
              "sg-0875fc019b6cabc27",
              "sg-0ed7bf07ffdb66f9a"
            ]
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "depends_on": [
            "aws_security_group.allow_becl46",
            "aws_security_group.cowrie_honeypot_exposed",
            "data.template_file.cowrie_user_data"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "allow_becl46",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:eu-west-1:228434638586:security-group/sg-0875fc019b6cabc27",
            "description": "Allow Admin",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0875fc019b6cabc27",
            "ingress": [
              {
                "cidr_blocks": [
                  "90.203.143.90/32"
                ],
                "description": "",
                "from_port": 22222,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22222
              }
            ],
            "name": "Allow BECL46 Admin",
            "name_prefix": null,
            "owner_id": "228434638586",
            "revoke_rules_on_delete": false,
            "tags": null,
            "timeouts": null,
            "vpc_id": "vpc-79ddc21f"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "cowrie_honeypot_exposed",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:eu-west-1:228434638586:security-group/sg-0ed7bf07ffdb66f9a",
            "description": "Public access to Cowrie honeypot port(s)",
            "egress": [],
            "id": "sg-0ed7bf07ffdb66f9a",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              }
            ],
            "name": "Cowrie Honeypot Ports",
            "name_prefix": null,
            "owner_id": "228434638586",
            "revoke_rules_on_delete": false,
            "tags": null,
            "timeouts": null,
            "vpc_id": "vpc-79ddc21f"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    }
  ]
}
